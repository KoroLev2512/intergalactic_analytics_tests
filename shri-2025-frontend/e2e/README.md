# E2E Тесты с Playwright

Этот каталог содержит end-to-end тесты для приложения анализа CSV файлов, написанные с использованием Playwright.

## Структура тестов

```
e2e/
├── home.spec.ts           # Тесты главной страницы
├── file-upload.spec.ts    # Тесты загрузки файлов
├── generate.spec.ts       # Тесты страницы создания анализа
├── history.spec.ts        # Тесты страницы истории
├── accessibility.spec.ts  # Тесты доступности
├── performance.spec.ts    # Тесты производительности
├── utils/
│   └── test-helpers.ts    # Общие утилиты для тестов
└── README.md             # Эта документация
```

## Запуск тестов

### Все тесты
```bash
npm run test:e2e
```

### Тесты с UI интерфейсом
```bash
npm run test:e2e:ui
```

### Тесты в видимом режиме (headed)
```bash
npm run test:e2e:headed
```

### Тесты в режиме отладки
```bash
npm run test:e2e:debug
```

### Просмотр отчета
```bash
npm run test:e2e:report
```

## Типы тестов

### 1. Функциональные тесты
- **home.spec.ts** - Проверка основных элементов интерфейса и навигации
- **file-upload.spec.ts** - Тестирование drag & drop, валидации файлов
- **generate.spec.ts** - Проверка процесса генерации анализа
- **history.spec.ts** - Тестирование истории анализов и модальных окон

### 2. Тесты доступности (Accessibility)
- **accessibility.spec.ts** - Проверка ARIA атрибутов, навигации с клавиатуры
- Валидация цветового контраста
- Проверка иерархии заголовков
- Тестирование skip links

### 3. Тесты производительности
- **performance.spec.ts** - Измерение времени загрузки страниц
- Проверка метрик Core Web Vitals
- Тестирование производительности навигации
- Проверка отсутствия утечек памяти

## Конфигурация

Тесты настроены для работы с:
- **Браузер**: Chromium (основной)
- **Базовый URL**: http://localhost:5173
- **Автозапуск сервера**: Да (через `npm run dev`)
- **Скриншоты**: Только при ошибках
- **Видео**: Сохраняется при ошибках
- **Трассировка**: При повторных попытках

## Утилиты

В `utils/test-helpers.ts` содержатся общие функции:
- `createTestCSV()` - Создание тестовых CSV файлов
- `uploadFile()` - Загрузка файлов в dropzone
- `waitForAnalysisGeneration()` - Ожидание завершения генерации
- `checkPerformanceMetrics()` - Проверка метрик производительности

## Лучшие практики

1. **Используйте data-testid атрибуты** для надежного поиска элементов
2. **Добавляйте комментарии на русском языке** для лучшего понимания
3. **Используйте общие утилиты** для повторяющихся операций
4. **Проверяйте доступность** всех интерактивных элементов
5. **Измеряйте производительность** критических операций

## Отладка

### Просмотр трассировки
```bash
npx playwright show-trace trace.zip
```

### Запуск в режиме отладки
```bash
npm run test:e2e:debug
```

### Просмотр отчета
```bash
npm run test:e2e:report
```

## CI/CD

Тесты настроены для запуска в CI/CD среде:
- Используется только Chromium для экономии времени
- Отключен параллельный запуск в CI
- Автоматический запуск dev сервера

## Добавление новых тестов

1. Создайте новый файл `.spec.ts` в корне `e2e/`
2. Используйте структуру `test.describe()` для группировки
3. Добавляйте `test.beforeEach()` для настройки
4. Используйте общие утилиты из `utils/test-helpers.ts`
5. Добавляйте комментарии на русском языке 